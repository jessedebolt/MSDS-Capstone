
# Primary Document for all code
# Setup
### Load libraries and knit setup


# Setup
### Files located in the GitHub repository data folder


# Setup
### Create a function to generate the URL for a given filename


# Setup
### Generate urls for each filename


# Setup
### Read the CSV files into a list of data frames


# Setup
### Merge all sets together into one data frame

# Setup
### Renaming variables


# Setup
### Read in data for table descriptions


# .
# .
# BREAK
# .
# .


# Data cleansing 
### Removing US territories


# Data cleansing 
### Separated County and State


# Data cleansing 
### Make backup and display first few rows


# Data cleansing 
### Relabeling Urban/Rural codes


# Data cleansing 
### Review header names, check for missing rural/urban values


# Data cleansing 
### Inserting Rural/Urban for missing value


# Data cleansing 
### Inserting Parks missing value


# Data cleansing 
### Checking for missing values


# Data cleansing 
### Remove counties with minimal data


# Data cleansing 
## Populating missing values
## Single value entry
### Inserting value for missing values in bpmUse for NJ


# Data cleansing 
### Inserting value for missing values in CholScreen for NJ



# Data cleansing 
### Inserting value for missing values in HighBP for NJ


# Data cleansing 
### Inserting value for missing values in Diabetes for NJ


# Data cleansing 
### Inserting value for missing values in HighChol for NJ



# Data cleansing 
### Inserting value for missing values in Obesity for NJ


# Data cleansing 
### Inserting values for missing values in Median Home Value


# Data cleansing 
## Multiple value entry
### Read in additional data



# Data cleansing 
### Populating missing items for PCPs and Cardio Phys




# .
# .
# Imputations to happen after split
# .
# .


# Data cleansing 
## Imputations
### Impute remaining missing Cardiologists and Primary Care Physicians based on median of urban/rural for each state


# Data cleansing 
### Imputing missing values in CholMedNonAdhear based on median of urban/rural for each state


# Data cleansing 
### Imputing missing values in CholMedElegible based on median of urban/rural for each state


# Data cleansing 
### Imputing missing values in cruParticipate based on median of urban/rural for each state


# Data cleansing 
### Imputing missing values in PhysInactivity based on median of urban/rural for each state



# Data cleansing 
### Imputing missing values in AirQuality based on median of urban/rural for each state


# Data cleansing 
### Checking for missing values



# Feature Engineering 
## Convert provider demographics
### Convert number of hospitals per county to number of hospitals per 100k residents


# Feature Engineering 
### Convert number of pharmacies per population to number of pharmacies per 100k residents



# Feature Engineering 
### Convert population per physicians to physician per 1k residents


# Feature Engineering 
### Convert population per cardiovascular physicians to cardiovascular physician per 100k residents


# Feature Engineering 
### Rearrange column layout


#.
#.
# BREAK
#.
#.


# Feature Engineering 
# Remove one hot encode for states and urban/rural ?????????
## Additional feature engineering
### One-hot encoding for the 'state' and 'UrbanRural' columns



# Feature Engineering 
## Export cleaned data to csv




# General EDA
## General EDA
### Show basic details and information


# General EDA
### Additional details



# General EDA
#### What is distribution of Urban Rural for Each State


# General EDA
#### Visualization - Stacked Bar



# General EDA
#### Visualization Bar



# General EDA
#### Top 5 states with most Urban



# General EDA
#### Top 10 states with most Rural


# General EDA
#### I like this one better I think



# General EDA
#### Top 10 states with most Large Fringe Urban


# General EDA
#### Medium Small Urban Areas



# General EDA
### Correlations


# General EDA
#### Negative Correlations


# General EDA
### Top 10 Counties with highest CHD prevalence



# General EDA
### Bottom 10 Counties with lowest CHD prevalence


# General EDA
### How many counties per state



# General EDA
### Auto EDA report (from DataExplorer)



# CHD EDA
## CHD Specific EDA
### Reviewing CHD prevalence




# CHD EDA
### Boxplot to compare coronary heart disease prevalence in rural and urban areas


# Rural/Urban EDA
### Histograms to understand distribution of various factors in rural and urban areas
#### Cardiovascular Providers



# Rural/Urban EDA
#### Primary Care Providers


# Rural/Urban EDA
#### Hospitals


# Rural/Urban EDA
#### Hospitals with Cardiac Intensive Care Centers



# Rural/Urban EDA
#### Hospitals with Cardiac Rehabilitation Centers


# Rural/Urban EDA
#### Pharmacies



# Rural/Urban EDA
### Population


# Rural/Urban EDA
### Air Quality



# Rural/Urban EDA
### Parks


# Rural/Urban EDA
### Broadband Access



# Rural/Urban EDA
### Education Less Than College


# Rural/Urban EDA
### Greater than 65 years old



# Statistical Analysis
## Statistical Analysis
### Correlation Analysis
#### General Correlation Matrix



# Statistical Analysis
### Correlation plots: CHD and Urban/Rural vs various factors
#### Prevalence of other heart conditions factors




# Statistical Analysis
#### Hospitals and pharmacy access factors



# Statistical Analysis
#### Hospital services factors



# Statistical Analysis
#### Physician and specialist access factors



# Statistical Analysis
#### Various health care delivery and insurance factors



# Statistical Analysis
#### Various (physical activity/smoking) risk factors



# Statistical Analysis
#### Various (other diagnosed)risk factors


# Statistical Analysis
#### Various physical environment factors


# Statistical Analysis
#### Various (income) social environmental factors


# Statistical Analysis
#### Various (housing) social environmental factors


# Statistical Analysis
#### Various (Education) social environmental factors


# Statistical Analysis
##### Density plot for EdLessCol by itself



# Statistical Analysis
### Correlation analysis between cardiovascular providers and coronary heart disease prevalence



# Statistical Analysis
#### CHD/cardiovascular physicians correlation analysis visualization


# Statistical Analysis
### Correlation analysis between primary care providers and coronary heart disease prevalence


# Statistical Analysis
#### CHD/primary care physicians correlation analysis visualization


# Statistical Analysis
### Correlation analysis between hospitals and coronary heart disease prevalence


# Statistical Analysis
#### CHD/hospitals correlation analysis visualization


# Statistical Analysis
### Correlation analysis between hospitals with cardiac intensive care centers and coronary heart disease prevalence


# Statistical Analysis
#### CHD/cardiac intensive care centers correlation analysis visualization


# Statistical Analysis
### Correlation analysis between hospitals with cardiac rehabilitation centers and coronary heart disease prevalence


# Statistical Analysis
#### CHD/hospitals with cardiac rehabilitation centers correlation analysis visualization


# Statistical Analysis
### Correlation analysis between pharmacies and coronary heart disease prevalence


# Statistical Analysis
#### CHD/pharmacies correlation analysis visualization


# Statistical Analysis
### Various (other) factors



# Statistical Analysis
## Density and Correlations for individual features and CHD
#### Population



# Statistical Analysis
#### Air Quality



# Statistical Analysis
#### Parks


# Statistical Analysis
#### Broadband Access



# Statistical Analysis
#### Education Less Than College


# Statistical Analysis
#### Greater than 65 years old



# Statistical Analysis
## Correlation analysis between CHD and various factors
### Population


# Statistical Analysis
### Air Quality


# Statistical Analysis
### Parks


# Statistical Analysis
### Broadband


# Statistical Analysis
### Education Less Than College


# Statistical Analysis
### Age over 65 years old


# Statistical Analysis
## Correlation Visualizations between CHD and various factors
### Population


# Statistical Analysis
### Air Quality


# Statistical Analysis
### Parks


# Statistical Analysis
### Broadband


# Statistical Analysis
### Education Less Than College


# Statistical Analysis
### Age Over 65 years old



# .
# .
# BREAK
# .
# .



# Feature Selection
## Feature Selection
### PCA
#### Prepare data for principle component analysis


# Feature Selection
#### Run PCA on the dataset


# Feature Selection
#### Run PCA on the dataset without hot coded states


# Regreassion analysis 
## Regreassion analysis
### Regression analysis for potential confounders.



# .
# .
# BREAK
# .
# .



# Predictive Modeling
# Predictive Modeling
### Split the data into training and test sets


# Predictive Modeling
### Build a random forest model


# Predictive Modeling
### Predict on the test set


# Predictive Modeling
## Predictions
### Policy intervention to increases the number of cardiovascular providers providers by 20% in rural areas



# Predictive Modeling
### Use the model to predict outcomes with the simulated data


# Predictive Modeling
### Compare the original predictions and the simulated predictions



# .
# .
# BREAK
# .
# .

# Hospital EDA
## more EDA (Hospitals)

### Histograms for numerical variables


# Hospital EDA
#### Looking closer at Hospitals


# Hospital EDA
#### Same as above but improved visual


# Hospital EDA
#### How many counties have no hospitals



# Hospital EDA
#### List of counties with 0 hospitals



#.
#.
# BREAK
#.
#.



# CHD EDA
#### Average prevalence of CHD


# CHD EDA
#### states with highest and lowest prevalence


# CHD EDA
#### states with highest and lowest prevalence visual



# CHD EDA
#### Heatmap for CHD Prevalence




# General EDA
#### Boxplots for each variable


# General EDA
#### Outliers



# General EDA
#### Just checking where missing values are


# Cleaning
####Test imputing data that is still missing

*********************************
# Linear Models
### Linear Model with CHD vs Urban Rural


# Linear Models
### Linear Model CHD vs Urban Rural + HighBP



# Linear Models
### Linear Model with various variables


# Linear Models
### Linear Model with Poverty


# Linear Models
### Linear Model with interactions 



# DELETE
#### Saved the data (can delete this)




#### Proportion for each level of Urban Rural
```{r}
# proportion of each level 'UrbanRural'
urban_rural_proportions <- cdc %>%
  group_by(UrbanRural) %>%
  summarise(n = n()) %>%
  mutate(prop = n / sum(n))

# Print the proportions
print(urban_rural_proportions)

```


#### Mean Prevalence for CHD by each level of Urban/Rural
```{r}

# Compute mean CHD prevalence for each category of UrbanRural
mean_chd <- cdc %>% 
  group_by(UrbanRural) %>% 
  summarise(mean_chd = mean(CHD))

# Print mean CHD prevalence
print(mean_chd)

```


#### Look at extremes for Urban Rural
```{r}
# Find urban areas (Large_Urban, LargeFringe_Urban, MediumSmall_Urban) with high CHD
urban_high_chd <- cdc %>% 
  filter(UrbanRural %in% c('Large_Urban', 'LargeFringe_Urban', 'MediumSmall_Urban'), 
         CHD > quantile(CHD, 0.95))

# Find rural areas with low CHD
rural_low_chd <- cdc %>% 
  filter(UrbanRural == 'Rural', CHD < quantile(CHD, 0.05))

# Print the top 5 urban areas with high CHD
print(head(urban_high_chd, 5))

# Print the top 5 rural areas with low CHD
print(head(rural_low_chd, 5))
```


#### Side by side of what's different between the two extremes
```{r}
# Get the names of numeric columns
numeric_columns <- names(cdc)[sapply(cdc, is.numeric)]

# Select the first 32 numeric columns
numeric_columns <- numeric_columns[1:32] #(1:32) Age95Plus:pcp

# Compute descriptive statistics for urban areas with high CHD
urban_high_chd_stats <- urban_high_chd %>%
  select(numeric_columns) %>%
  summarise_all(list(mean = mean, sd = sd), na.rm = TRUE)

# Compute descriptive statistics for rural areas with low CHD
rural_low_chd_stats <- rural_low_chd %>%
  select(numeric_columns) %>%
  summarise_all(list(mean = mean, sd = sd), na.rm = TRUE)

# Add a group indicator
urban_high_chd_stats$group <- "urban_high_chd"
rural_low_chd_stats$group <- "rural_low_chd"

# Bind the rows
combined_stats <- bind_rows(urban_high_chd_stats, rural_low_chd_stats)

# Reshape from wide to long format
long_stats <- pivot_longer(combined_stats, -group, names_to = c(".value", "statistic"), names_pattern = "(.+)_(.+)")

# Print the long format stats
print(long_stats)
```



```{r}
# Separate the mean and standard deviation rows
mean_stats <- long_stats %>% filter(statistic == "mean")
sd_stats <- long_stats %>% filter(statistic == "sd")

# Merge the data frames by group and variable names
merged_stats <- merge(mean_stats, sd_stats, by = c("group"), suffixes = c("_mean", "_sd"))

# Plot mean and sd for CHD
ggplot(merged_stats, aes(x = group, y = CHD_mean, fill = group)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = CHD_mean - CHD_sd, ymax = CHD_mean + CHD_sd), width = 0.2, position = position_dodge(0.9)) +
  labs(title = "Mean and Standard Deviation of CHD", x = "Group", y = "Mean CHD")

```


#### 
```{r}
# Convert data from wide to long format
long_data <- gather(merged_stats, variable, value, -group)

# Select variables
# selected_vars <- c("bpmUse", "CholScreen", "Obesity", "CholMedNonAdhear", "CholMedElegible", "cruParticipate", "Hospitals")

# selected_vars <- c("bpmUse", "CholScreen", "CholMedNonAdhear", "CholMedElegible", "cruParticipate", "Hospitals", "HospCIC", 
# "HospCR", "HospED", "Pharmacies", "CardioPhys", "PrimaryCarePhys", "CHD", "HighBP", "Stroke", "Diabetes", "HighChol", "Obesity",
# "PhysInactivity", "Smoker", "AirQuality", "Parks", "Broadband", "EdLessColl", "SNAPrecipients", "MedHomeValue", "MedHouseIncome", 
# "Poverty", "Unemploy")

selected_vars <- cdc_subset %>% names()

# Loop over selected variables
for (var in selected_vars) {
  # Filter data for this variable (mean only)
  var_data <- filter(long_data, variable == paste0(var, "_mean"))
  
  # Create bar plot
  p <- ggplot(var_data, aes(x = group, y = value, fill = group)) +
    geom_bar(stat = "identity", position = position_dodge()) +
    labs(title = paste("Comparison of", var, "between Groups"),
         x = "Group",
         y = "Value") 
  
  # Print plot
  print(p)
}

```


















# DELETE??????
####Saving for possible use later
```{r}
# Splitting the data into training and testing sets
#library(caret)
#set.seed(123)  # For reproducibility
#train_indices <- createDataPartition(cdc$target_variable, p = 0.7, list = FALSE)
#train_data <- data[train_indices, ]
#test_data <- data[-train_indices, ]

```

```{r}
# Example of building a linear regression model using caret
#library(caret)
#set.seed(123)  # For reproducibility
#model <- train(target_variable ~ ., data = train_data, method = "lm")  # Replace 'target_variable' with #your target variable/column name

# Model evaluation
#predictions <- predict(model, newdata = test_data)

```



```{r}
cdc_lm <- cdc %>% select (5:66,) #(5:66) All numeric excluding hot coded
#NOTE: Above changed from cdc_copy to cdc by Jesse after adding additional cols

model <- lm(CHD ~ ., data = cdc_lm)

model

summary(model)
```



```{r}
library(rpart)

cdc_test <- cdc %>% select (3, 5:66, ) #(3, 5:66, ) state, all numeric excl.hot code

cdc_test <- cdc_test %>% select(-c(Stroke, HighChol))

tree_model <- rpart(CHD ~ ., data=cdc_test)

library(rpart.plot)
rpart.plot(tree_model)

tree_model$variable.importance
```



```{r}
library(rpart)
library(rpart.plot)

cdc_test <- cdc %>% select (3, 5:66, ) #(3, 5:66, ) state, all numeric excl.hot code

cdc_test <- cdc_test %>% select(-c(Stroke, HighChol, Smoker, HighBP))

tree_model <- rpart(CHD ~ ., data=cdc_test)

rpart.plot(tree_model)
tree_model$variable.importance

cdc_test <- cdc %>% select (5:66, ) #(5:66) All numeric excluding hot coded

cdc_test <- cdc_test %>% select(-c(Stroke, HighChol, Smoker, HighBP))

tree_model <- rpart(CHD ~ ., data=cdc_test)

rpart.plot(tree_model)
tree_model$variable.importance
```
```{r}
cdc_test <- cdc %>% select (3, 5:66, ) #(3, 5:66, ) state, all numeric excl.hot code

cdc_test <- cdc_test %>% select(-c(bpmUse, Age65Plus, Stroke, HighChol, Smoker, HighBP))

tree_model <- rpart(CHD ~ ., data=cdc_test)

rpart.plot(tree_model)
tree_model$variable.importance

modeltest <- lm(CHD ~ MedHouseIncome*EdLessColl*Broadband + bpmUse + Age65Plus + Stroke + HighChol + Smoker + HighBP, data=cdc)
summary(modeltest)
```


# .
# .
# BREAK
# .
# .

# **Isaac new work**
## **Additional eda**
Diabetes
Obesity
Physical Inactivity
Health Insurance
Non Adherence all med types
Med Home Value/med house income/Income Inequality/poverty

********************************

# Diabetes EDA
## Diabetes


# Diabetes EDA
### Top 10 Counties with highest Diabetes prevalence



# Diabetes EDA
### Bottom 10 Counties with lowest Diabetes prevalence


# Diabetes EDA
#### Density plot for Diabetes UrbanRural


# Diabetes EDA
### Diabetes Boxplot


# Diabetes EDA
### Correlation analysis between Diabetes, Obesity, and physical inactivity


# Diabetes EDA
#### Highest and Lowest States Diabetes Prevalence


# Obesity EDA
## Obesity

# Diabetes EDA
### Top 10 Counties with highest Obesity prevalence

# Diabetes EDA
### Bottom 10 Counties with lowest Obesity prevalence

# Diabetes EDA
#### Density plot for Obesity UrbanRural

# Diabetes EDA
### Obesity Boxplot


# Diabetes EDA
#### Highest and Lowest States rates of Obesity


# Physical Inactivity EDA
## Physical Inactivity


# Physical Inactivity EDA
### Top 10 Counties with highest % of Physical Inactivity


# Physical Inactivity EDA
### Bottom 10 Counties with lowest % of Physical Inactivity

# Physical Inactivity EDA
#### Density plot for Physical Inactivity UrbanRural


# Physical Inactivity EDA
### PhysInactivity Boxplot

# Physical Inactivity EDA
#### Highest and Lowest States Rates of Physical Inactivity


# Medication Non Adherence EDA
## Medication Non Adherence


# Medication Non Adherence EDA
### Top 10 Counties with highest CholMedNonAdhear

# Medication Non Adherence EDA
### Bottom 10 Counties with lowest CholMedNonAdhear

# Medication Non Adherence EDA
#### Density plot for CholMedNonAdhear UrbanRural


# Medication Non Adherence EDA
### Medication Nonadherence Boxplot


# Medication Non Adherence EDA
#### Highest and Lowest States Rates of CholMedNonAdhear

# Health Insurance EDA
## Health Insurance (no Health Insurance %)

# Health Insurance EDA
### Top 10 Counties with highest rates % of No Health Insurance


# Health Insurance EDA
### Bottom 10 Counties with lowest rates % of No Health Insurance

# Health Insurance EDA
#### Density plot for No HealthIns UrbanRural

# Health Insurance EDA
### HealthIns Boxplot


# Health Insurance EDA
#### Highest and Lowest States Rates of No Health Insurance

# Median Home Value EDA
## Median Home Value


# Median Home Value EDA
### Bottom 10 Counties with lowest MedHomeValue


# Median Home Value EDA
#### Density plot for MedHomeValue UrbanRural

# Median Home Value EDA
### MedHomeValue Boxplot

# Median Home Value EDA
#### Highest and Lowest States of MedHomeValue

# Median Household Income EDA
## Median Household Income


# Median Household Income EDA
### Top 10 Counties with highest MedHouseIncome

# Median Household Income EDA
### Bottom 10 Counties with lowest MedHouseIncome


# Median Household Income EDA
#### Density plot for MedHouseIncome UrbanRural

# Median Household Income EDA
### MedHouseIncome Boxplot


# Median Household Income EDA
#### Highest and Lowest States of MedHouseIncome

# Poverty EDA
## Poverty


# Poverty EDA
### Top 10 Counties with highest % Poverty

# Poverty EDA
### Bottom 10 Counties with lowest % Poverty

# Poverty EDA
#### Density plot for Poverty UrbanRural

# Poverty EDA
### Poverty Boxplot


# Poverty EDA
#### Highest and Lowest States % of Poverty


# .
# .
# BREAK
# .
# .


# **Jesse new work**
## **Additional eda**


# Linear Models
## Linear Model with various variables
### CHD, Population, Air Quality, Parks, Broadband Access, Education Less Than College, and Age greater than 65.


# Linear Models
### CHD, Population,  Age greater than 65.


# Linear Models
### CHD, Broadband, Parks, Age greater than 65.


# Linear Models
### CHD, Parks, Age greater than 65.


# Linear Models
### CHD, Air Quality, Age greater than 65.


# Linear Models
## Linear Model with interactions
### CHD, Population, Air Quality, Parks, Broadband Access, Education Less Than College, and Age greater than 65.


# Linear Models
### CHD, Population,  Age greater than 65.

# Linear Models
### CHD, Broadband, Parks, Age greater than 65.


# Linear Models
### CHD, Parks, Age greater than 65.

# Linear Models
### CHD, Air Quality, Age greater than 65.



# .
# .
# BREAK
# .
# .


# DELETE
# REFERENCE INFORMATION
## Name mapping:


## Abbreviation descriptions

# Setup
# Cleaning
# Feature Engineering
# General EDA
# CHD EDA
# Rural/Urban EDA
# Hospital EDA
# Diabetes EDA
# Obesity EDA
# Physical Inactivity EDA
# Medication Non Adherence EDA
# Health Insurance EDA
# Median Home Value EDA
# Median Household Income EDA
# Statistical Analysis
# Regreassion Analysis
# Linear Models
# Feature Selection
# Predictive Modeling

# DELETE

